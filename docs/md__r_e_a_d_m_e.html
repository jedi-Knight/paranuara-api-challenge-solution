<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Paranuara API Challenge Solution: Paranuara Challenge Solution</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Paranuara API Challenge Solution
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Paranuara Challenge Solution </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h4>Table of Contents</h4>
<ul>
<li><a href="#dependencies">Dependencies</a></li>
<li><a href="#to-build-and-run-on-jenkins">To Build and Run on Jenkins</a></li>
<li><a href="#to-build-and-run-on-localhost">To Build and Run On Localhost</a><ul>
<li><a href="#to-build">To Build</a><ul>
<li><a href="#to-use-different-companiesjson-and-peoplejson-files">To use different companies.json and people.json files during build</a></li>
</ul>
</li>
<li><a href="#to-run">To Run</a></li>
</ul>
</li>
<li><a href="#to-test-the-api-endpoints-solutions">To test the API endpoints (ie. the challenge solutions)</a><ul>
<li><a href="#api-endpoints">API Endpoints</a><ul>
<li><a href="#1-api-endpoint-to-get-all-employees-for-a-given-company">1. API endpoint to get all employees for a given company</a></li>
<li><a href="#2-api-endpoint-to-get-the-name-age-address-and-phone-information-about-two-people-and-a-list-of-their-friends-in-common-who-have-brown-eyes-and-are-still-alive">2. API endpoint to get the Name, Age, Address and phone information about two people, and a list of their friends in common who have brown eyes and are still alive</a></li>
<li><a href="#3-api-endpoint-to-get-the-name-and-age-of-one-person-and-the-fruits-and-vegetables-they-like">3. API endpoint to get the name and age of one person and the fruits and vegetables they like</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#to-run-tests">To Run Tests</a></li>
<li><a href="#code-overview">Code Overview</a></li>
</ul>
<h2>Dependencies</h2>
<ol type="1">
<li>Docker version 18.09.3.</li>
<li>Jenkins 2.150.3.</li>
<li>Docker plugin installed on Jenkins.</li>
<li>Jenkins pipeline access to the <code>docker</code> command.</li>
<li>Connectivity to Docker Hub and PypI.</li>
</ol>
<h2>To Build and Run on Jenkins</h2>
<p>The Jenkins pipeline definition is in the <code>Jenkinsfile</code> of this repo.</p>
<p>To use it with Jenkins, create a new SCM or GitHub based pipeline on Jenkins and enter this repository url as the source. Then Use <code>Jenkinsfile</code> as the script path (this is the default setting if using Jenkin's Blue Ocean UI).</p>
<p>Start the pipeline build. Jenkin runs the pipeline Build, Run and Test tasks.</p>
<p>On Sucessful execution of the Run task, the API is accessible at port <code>8383</code> of the Jenkins-Docker host machine. <code><a href="http://">http://</a>&lt;Jenkins server address&gt;:8383/</code></p>
<p>The API endpoints are described in the <em>To test the API endpoints (solutions)</em> section below. Please replace <em>localhost</em> with the Jenkins-Docker host address to test the examples on the CI server.</p>
<h2>To Build and Run On Localhost</h2>
<h3>To Build</h3>
<p>Clone or download this repository, change directory to the repository path, then run this command:</p>
<div class="fragment"><div class="line">$ docker build -t paranuara-challenge-solution -f DOCKER .</div></div><!-- fragment --><h4>To use different companies.json and people.json files</h4>
<p>Before running the build command, either replace the files in data/ directory of this repo with the new files, or edit the <code>DATA_FILE</code> entry in <code>config.py</code> to point to their location. Absolute path, relative path and URIs can also be used with the <code>DATA_FILE</code> option.</p>
<h2>To Run</h2>
<p>After completing the build steps above, run this command:</p>
<div class="fragment"><div class="line">$ docker run -p 127.0.0.1:8383:8080 -dit --rm paranuara-challenge-solution</div></div><!-- fragment --><h2>To test the API endpoints (solutions)</h2>
<h4>Please note:</h4>
<ol type="1">
<li>The company/people names and return values used for the following examples are based on the JSON data included in the challenge GitHub repo. Please change the company and user names to test with different data.</li>
<li>The API should be running for the below endpoints to be accessible. To run the API, please follow the steps described above.</li>
</ol>
<h3>API Endpoints</h3>
<h5>1. API endpoint to get all employees for a given company</h5>
<h5><code><a href="http://localhost:8383/company/">http://localhost:8383/company/</a>&lt;company name&gt;</code></h5>
<p>To test this endpoint, click the following links with the API running locally:</p>
<p><em>Example 1.1:</em></p>
<p><a href="http://localhost:8383/company/NETBOOK">http://localhost:8383/company/PERMADYNE</a></p>
<p>Here the company name is PERMADYNE. Following is its JSON return: </p><div class="fragment"><div class="line">{</div><div class="line">    &quot;number-of-employees&quot;: 7,</div><div class="line">    &quot;employees&quot;: </div><div class="line">        [</div><div class="line">        &quot;Frost Foley&quot;, </div><div class="line">        &quot;Luna Rodgers&quot;, </div><div class="line">        &quot;Boyer Raymond&quot;, </div><div class="line">        &quot;Solomon Cooke&quot;, </div><div class="line">        &quot;Walter Avery&quot;, </div><div class="line">        &quot;Hester Malone&quot;, </div><div class="line">        &quot;Arlene Erickson&quot;</div><div class="line">        ]</div><div class="line">}</div></div><!-- fragment --><p> The <code>number-of-employees</code> field gives the number of employees of the company, the <code>employees</code> field gives the names of the employees as an array.</p>
<p><em>Example 1.2:</em></p>
<p><a href="http://localhost:8383/company/NETBOOK">http://localhost:8383/company/NETBOOK</a></p>
<p>Here the company name is NETBOOK. Following is its JSON return: </p><div class="fragment"><div class="line">{</div><div class="line">    &quot;number-of-employees&quot;: 0, </div><div class="line">    &quot;employees&quot;: [],</div><div class="line">    &quot;message&quot;: &quot;The company has no employees.&quot;</div><div class="line">}</div></div><!-- fragment --><p> If a company has no employees, the <code>number-of-employees</code> and <code>employees</code> field reflect this fact and a <code>message</code> field is included in the JSON which includes a string message.</p>
<h4>2. API endpoint to get the Name, Age, Address and phone information about two people, and a list of their friends in common who have brown eyes and are still alive</h4>
<h4><code><a href="http://localhost:8383/user/">http://localhost:8383/user/</a>&lt;one user name&gt;/&lt;another user name&gt;</code></h4>
<p><em>Example 2.1:</em></p>
<p><a href="http://localhost:8383/user/Sharron%20Barker/Moon%20Herring">http://localhost:8383/user/Sharron%20Barker/Moon%20Herring</a></p>
<p>The following is the JSON return containing information about the two - people Sharron Barker and Moon Herring, and their friends in common who have brown eyes and are alive:</p>
<div class="fragment"><div class="line">{</div><div class="line">    &quot;user-1&quot;: {</div><div class="line">        &quot;name&quot;: &quot;Sharron Barker&quot;,</div><div class="line">        &quot;age&quot;: 28.0,</div><div class="line">        &quot;address&quot;: &quot;598 Polhemus Place, Ogema, Marshall Islands, 3906&quot;,</div><div class="line">        &quot;phone&quot;: &quot;+1 (856) 530-3907&quot;</div><div class="line">    },</div><div class="line">    &quot;user-2&quot;: {</div><div class="line">        &quot;name&quot;: &quot;Moon Herring&quot;,</div><div class="line">        &quot;age&quot;: 40.0,</div><div class="line">        &quot;address&quot;: &quot;718 Locust Street, Ernstville, Kentucky, 741&quot;,</div><div class="line">        &quot;phone&quot;: &quot;+1 (947) 466-2999&quot;</div><div class="line">    },</div><div class="line">    &quot;friends-in-common&quot;: [</div><div class="line">        &quot;Mindy Beasley&quot;,</div><div class="line">        &quot;Whitfield Deleon&quot;,</div><div class="line">        &quot;Goodwin Cook&quot;,</div><div class="line">        &quot;Decker Mckenzie&quot;</div><div class="line">    ]</div><div class="line">}</div></div><!-- fragment --><h4>3. API endpoint to get the name and age of one person and the fruits and vegetables they like</h4>
<h4><code><a href="http://localhost:8383/user/">http://localhost:8383/user/</a>&lt;user name&gt;</code></h4>
<p><em>Example 3.1:</em></p>
<p><a href="http://localhost:8383/user/Leblanc%20Talley">http://localhost:8383/user/Leblanc%20Talley</a></p>
<p>Here the company name is NETBOOK. Following is its JSON return:</p>
<div class="fragment"><div class="line">{</div><div class="line">    &quot;username&quot;: &quot;Leblanc Talley&quot;,</div><div class="line">    &quot;age&quot;: 55,</div><div class="line">    &quot;fruits&quot;: [</div><div class="line">        &quot;orange&quot;,</div><div class="line">        &quot;apple&quot;</div><div class="line">    ],</div><div class="line">    &quot;vegetables&quot;: [</div><div class="line">        &quot;carrot&quot;,</div><div class="line">        &quot;celery&quot;</div><div class="line">    ]</div><div class="line">}</div></div><!-- fragment --><p>The JSON return respects the specified interface, i.e.: <code>{"username": "Ahi", "age": "30", "fruits": ["banana", "apple"], "vegetables": ["beetroot", "lettuce"]}</code></p>
<h2>To Run Tests</h2>
<p>The following command runs unit tests within the container using pytest: </p><div class="fragment"><div class="line">$ docker run -t --entrypoint /paranuara/api/test.sh --rm paranuara-challenge-solution</div></div><!-- fragment --><p> As described in the <em>Code Overview</em> section below (#6), these tests cover unit tests as well as the API endpoint functional tests. <code>Pytest</code> is used for the tests, the PyPI package gets installed by the <code>test.sh</code> script along with the <code>requests</code> package to test the API endpoints over HTTP.</p>
<h2>Code Overview</h2>
<p>All of the application modules are in the repo root.</p><ol type="1">
<li><code>server.py</code> is the entry point which gets invoked on run and starts a web server. It consists of route definitions for HTTP requests. The <code>bottle.py</code> package (from PyPI) provides the WSGI interface.</li>
<li>The <code>app.py</code> module is the middle layer between the route definitions of <code>server.py</code> and the output JSON builders of <code>view.py</code>. The App object initializes the data model as a Model object, loads the data into the Model object from the file path/URI defined in <code>config.py</code>, and binds it to the View object. The App object's methods get invoked by the routing functions of the <code>server</code> module. These methods perform the task of unencoding the URL parameters into plain strings and passing them into the View object's corresponding methods.</li>
<li>The <code>view.py</code> module sends invokes query methods of the data model and passes the parameters received from the <code>app</code> module. The View object consists of methods that transform and map the data received from the data model queries into Python dictionary objects of the required output schema and returns them to the App for JSON serialization.</li>
<li><code>model.py</code> provides the Model class which loads the JSON files into a Pandas DataFrame object and merges them (using file path/URI and merge keys defined in <code>config.py</code> that get passed during Model instantiation by App). The DataFrame object acts like an in-memory single-table database combining both company and people data. It relies on a separate helper class Query defined in <code>query.py</code> to provide an interface for running queries on the combined table.</li>
<li>The <code>query.py</code> module provides the Query class which has helper methods to perform queries on the Model and return results. These methods return query results as record sets in the form lists of dictionaries. The Query class itself relies on the QueryBuilder class (defined in the same module) which provides an interface for building queries for use on a Pandas DataFrame such as testing multiple values against multiple columns or multiple values within a column.</li>
<li><b>The <code>test_app.py</code>, <code>test_view.py</code>, <code>test_model.py</code> and <code>test_query.py</code> modules provide unit tests for the app, view, model and query modules respectively. The <code>test_http.py</code> module provides functional tests for the endpoint interfaces specified by the challenge problem statement.</b></li>
<li>Others:<ul>
<li><code>Jenkinsfile</code>: Jenkins task pipeline is defined here.</li>
<li><code>DOCKER</code>: Dockerfile to build the API container.</li>
<li><code>setup.sh</code>: This executed within the API container during build. It creates a virtual environment and installs Python dependencies using pip.</li>
<li><code>start.sh</code>: This gets executed within the API container during run. It runs <code>server.py</code> within the container.</li>
<li><code>tesh.sh</code>: Executable shell script to install <code>pytest</code> and <code>requests</code> packages fro PyPI and run tests when the container is run in test mode using the command described in the "To Run Unit Test" section above.</li>
<li><code>requirements.txt</code>: List of dependencies installed by pip running inside the Docker container during build.</li>
<li><code>.travis.yml</code> Required only if using the Travis-CI pipeline. </li>
</ul>
</li>
</ol>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
